[{"name":"/messages","nodes":[{"id":"8a5c283f-12e5-2678-bab4-5436b2da6cbf","type":"Page","parameters":{"title":"App"},"ports":[],"children":[{"id":"321923f5-ffbf-78de-9558-fc23c14839e3","type":"Group","parameters":{"flexDirection":"column"},"ports":[],"children":[{"id":"1e45786d-ba97-c83b-4313-e37b7e6ada5b","type":"Group","parameters":{"sizeMode":"explicit","scrollEnabled":true,"width":{"value":60,"unit":"%"},"alignX":"center","paddingTop":{"value":20,"unit":"px"},"paddingBottom":{"value":20,"unit":"px"},"rowGap":{"value":8,"unit":"px"},"maxHeight":{"value":70,"unit":"vh"},"flexDirection":"column"},"ports":[],"children":[{"id":"ddb3b8ec-c7f3-1fe8-390e-bc83773a5977","type":"For Each","parameters":{"templateType":"explicit","template":"/message"},"ports":[],"children":[]}]},{"id":"b5c9e7f7-aacb-6ff4-cf75-cae2fcdd0964","type":"Group","parameters":{"sizeMode":"contentHeight","width":{"value":60,"unit":"%"},"alignX":"center","flexDirection":"row"},"ports":[],"children":[{"id":"04162095-8493-48e0-5249-1c4608d98b57","type":"net.noodl.controls.textinput","parameters":{"alignY":"bottom","width":{"value":80,"unit":"%"},"alignX":"left","label":"Your message"},"ports":[],"children":[]},{"id":"a389691e-c35f-3593-0db4-03da8ca62a3e","type":"net.noodl.controls.button","parameters":{"alignY":"bottom","label":"Send mesage","marginLeft":{"value":8,"unit":"px"}},"ports":[],"children":[]}]},{"id":"f03433b6-cea3-64da-c709-f6a96a34103f","type":"Group","parameters":{"flexDirection":"row","sizeMode":"contentSize","alignX":"center","alignY":"bottom"},"ports":[],"children":[{"id":"6c336c9c-8a3f-23c9-1234-3ff20ab8a661","type":"Text","parameters":{"sizeMode":"contentSize","alignY":"bottom","fontSize":{"value":24,"unit":"px"},"fontFamily":"fonts/Roboto/Roboto-BoldItalic.ttf","text":"Current room: "},"ports":[],"children":[]},{"id":"ce28e14c-4f11-ea1b-7b59-ff3f8bfb40a5","type":"Text","parameters":{"textAlignX":"center","alignY":"bottom","sizeMode":"contentSize","fontSize":{"value":24,"unit":"px"},"fontFamily":"fonts/Roboto/Roboto-Italic.ttf","color":"#FF0000"},"ports":[],"children":[]}]},{"id":"6e101ee1-3d6a-7bf7-77ee-53cd148e74e1","type":"Group","parameters":{"borderStyle":"none","paddingLeft":{"value":8,"unit":"px"},"paddingRight":{"value":8,"unit":"px"},"paddingTop":{"value":8,"unit":"px"},"paddingBottom":{"value":8,"unit":"px"},"backgroundColor":"#FFFFFF","sizeMode":"contentHeight","alignX":"center","width":{"value":80,"unit":"%"},"flexDirection":"column","alignY":"bottom"},"ports":[],"children":[{"id":"b1903e2b-4805-ee73-8ae9-3526ad651308","type":"Group","parameters":{"sizeMode":"contentSize","alignX":"center","flexDirection":"row"},"ports":[],"children":[{"id":"412e6636-34a1-b09f-8a11-9797d4905909","type":"Text","parameters":{"sizeMode":"contentSize","fontSize":{"value":24,"unit":"px"},"text":"You are logged in as "},"ports":[],"children":[]},{"id":"736cf198-f1f0-2f69-9a01-3029928207ca","type":"Text","parameters":{"sizeMode":"contentSize","fontSize":{"value":24,"unit":"px"},"text":"","color":"#FF0000","fontFamily":"fonts/Roboto/Roboto-BlackItalic.ttf"},"ports":[],"children":[]}]},{"id":"f2044f26-b4f6-0379-f5ef-f053af953ac1","type":"Group","parameters":{"alignX":"center","sizeMode":"contentSize","flexDirection":"row","columnGap":{"value":8,"unit":"px"}},"ports":[],"children":[{"id":"c696ce8c-a668-fd3f-fb66-935de896d247","type":"net.noodl.controls.button","parameters":{"label":"Back to rooms list","marginTop":{"value":8,"unit":"px"}},"ports":[],"children":[]},{"id":"ce1564e1-1c2f-26cc-1db7-cb8590e37c84","type":"net.noodl.controls.button","parameters":{"label":"Log out","marginTop":{"value":8,"unit":"px"}},"ports":[],"children":[]}]}]}]}]},{"id":"6f4fd501-0bf7-f1a6-ed27-040382423d8c","type":"RouterNavigate","parameters":{"router":"Main","target":"/login"},"ports":[],"children":[]},{"id":"6c0b7163-2cd2-e01d-5ee7-de1f705ae1c8","type":"JavaScriptFunction","parameters":{"functionScript":"if(pb.authStore.isValid === false) Outputs.notLogin();\r\nelse {\r\n    Outputs.isLogin();\r\n    const record = await pb.collection('users').getOne(pb.authStore.model.id);\r\n    Outputs.username = record.username;\r\n}","scriptOutputs":[{"id":"s7q2","label":"username"}]},"ports":[{"name":"outtype-username","displayName":"Type","editorName":"username | Type","plug":"input","type":{"name":"enum","enums":[{"value":"string","label":"String"},{"value":"boolean","label":"Boolean"},{"value":"number","label":"Number"},{"value":"object","label":"Object"},{"value":"date","label":"Date"},{"value":"array","label":"Array"},{"value":"color","label":"Color"},{"value":"signal","label":"Signal"}],"allowEditOnly":true},"default":"string","parent":"scriptOutputs","parentItemId":"s7q2","index":4},{"name":"out-username","displayName":"username","plug":"output","type":"*","group":"Outputs","index":5},{"name":"out-notLogin","displayName":"notLogin","plug":"output","type":"signal","group":"Outputs","index":6},{"name":"out-isLogin","displayName":"isLogin","plug":"output","type":"signal","group":"Outputs","index":7}],"children":[]},{"id":"a05eeb97-237d-eaa7-e101-f3194f739ec5","type":"JavaScriptFunction","parameters":{"functionScript":"pb.authStore.clear();\r\nOutputs.done();"},"ports":[{"name":"out-done","displayName":"done","plug":"output","type":"signal","group":"Outputs","index":4}],"children":[]},{"id":"f2b5b802-1c2c-1c82-378d-86c4b3b871a3","type":"JavaScriptFunction","parameters":{"functionScript":"const data = {\r\n    \"text\": Inputs.text,\r\n    \"user_sent\": Inputs.user_sent,\r\n    \"room_id\" : Inputs.room_id\r\n};\r\n\r\nconst record = await pb.collection('message').create(data);","scriptInputs":[{"id":"cpff","label":"text"},{"id":"pvxz","label":"user_sent"},{"id":"5bye","label":"room_id"}]},"ports":[{"name":"intype-text","displayName":"Type","editorName":"text | Type","plug":"input","type":{"name":"enum","enums":[{"value":"string","label":"String"},{"value":"boolean","label":"Boolean"},{"value":"number","label":"Number"},{"value":"object","label":"Object"},{"value":"date","label":"Date"},{"value":"array","label":"Array"},{"value":"color","label":"Color"}],"allowEditOnly":true},"default":"string","parent":"scriptInputs","parentItemId":"cpff","index":4},{"name":"in-text","displayName":"text","plug":"input","type":"string","group":"Inputs","index":5},{"name":"intype-user_sent","displayName":"Type","editorName":"user_sent | Type","plug":"input","type":{"name":"enum","enums":[{"value":"string","label":"String"},{"value":"boolean","label":"Boolean"},{"value":"number","label":"Number"},{"value":"object","label":"Object"},{"value":"date","label":"Date"},{"value":"array","label":"Array"},{"value":"color","label":"Color"}],"allowEditOnly":true},"default":"string","parent":"scriptInputs","parentItemId":"pvxz","index":6},{"name":"in-user_sent","displayName":"user_sent","plug":"input","type":"string","group":"Inputs","index":7},{"name":"intype-room_id","displayName":"Type","editorName":"room_id | Type","plug":"input","type":{"name":"enum","enums":[{"value":"string","label":"String"},{"value":"boolean","label":"Boolean"},{"value":"number","label":"Number"},{"value":"object","label":"Object"},{"value":"date","label":"Date"},{"value":"array","label":"Array"},{"value":"color","label":"Color"}],"allowEditOnly":true},"default":"string","parent":"scriptInputs","parentItemId":"5bye","index":8},{"name":"in-room_id","displayName":"room_id","plug":"input","type":"string","group":"Inputs","index":9}],"children":[]},{"id":"9472e10d-1e99-c662-add7-335a64507b57","type":"JavaScriptFunction","parameters":{"functionScript":"pb.collection('message').subscribe('*', function (e) {\r\n    console.log(e.record);\r\n    Outputs.newMessage();\r\n}, { /* other options like expand, custom headers, etc. */ })\r\nOutputs.done();"},"ports":[{"name":"out-newMessage","displayName":"newMessage","plug":"output","type":"signal","group":"Outputs","index":4},{"name":"out-done","displayName":"done","plug":"output","type":"signal","group":"Outputs","index":5}],"children":[]},{"id":"e165f2bb-6b3f-bb05-8792-db0a60d9ce17","type":"JavaScriptFunction","parameters":{"functionScript":"const result = await fetch(`https://ikniz.pockethost.io//api/collections/message/records?filter=(room_id=\"${Inputs.room_id}\")`);\r\nconst resultList = await result.json();\r\n\r\nOutputs.list = resultList.items;\r\nOutputs.done();","scriptOutputs":[{"id":"3hwd","label":"list"}],"outtype-list":"array"},"ports":[{"name":"outtype-list","displayName":"Type","editorName":"list | Type","plug":"input","type":{"name":"enum","enums":[{"value":"string","label":"String"},{"value":"boolean","label":"Boolean"},{"value":"number","label":"Number"},{"value":"object","label":"Object"},{"value":"date","label":"Date"},{"value":"array","label":"Array"},{"value":"color","label":"Color"},{"value":"signal","label":"Signal"}],"allowEditOnly":true},"default":"string","parent":"scriptOutputs","parentItemId":"3hwd","index":4},{"name":"out-list","displayName":"list","plug":"output","type":"array","group":"Outputs","index":5},{"name":"in-room_id","displayName":"room_id","plug":"input","type":"*","group":"Inputs","index":6},{"name":"out-done","displayName":"done","plug":"output","type":"signal","group":"Outputs","index":7}],"children":[]},{"id":"feb5e6ea-7c4a-0cb2-63dd-97f23b349e42","type":"Collection2","parameters":{"collectionId":"messages"},"ports":[],"children":[]},{"id":"41e17117-7498-45c0-6ff1-9ada4a754e38","type":"PageInputs","parameters":{"pathParams":"room_id"},"ports":[],"children":[]},{"id":"0b2e6f00-4aec-2572-6f43-6b168d79de00","type":"JavaScriptFunction","parameters":{"functionScript":"if(!Inputs.room_id) Outputs.noRoomId();"},"ports":[{"name":"in-room_id","displayName":"room_id","plug":"input","type":"*","group":"Inputs","index":4},{"name":"out-noRoomId","displayName":"noRoomId","plug":"output","type":"signal","group":"Outputs","index":5}],"children":[]},{"id":"ab1fcfd9-cb1f-59ef-4d09-cb64724cadb8","type":"RouterNavigate","parameters":{"router":"Main","target":"/rooms"},"ports":[],"children":[]},{"id":"15222e2c-334a-3329-40a6-6f5dad679f23","type":"RouterNavigate","parameters":{"router":"Main","target":"/rooms"},"ports":[],"children":[]},{"id":"1a7a442d-276f-1084-6aa6-4e530b14e297","type":"JavaScriptFunction","parameters":{"functionScript":"if(Inputs.text) Outputs.hasText();"},"ports":[{"name":"in-text","displayName":"text","plug":"input","type":"*","group":"Inputs","index":4},{"name":"out-hasText","displayName":"hasText","plug":"output","type":"signal","group":"Outputs","index":5}],"children":[]}],"connections":[{"sourceId":"6c0b7163-2cd2-e01d-5ee7-de1f705ae1c8","sourcePort":"out-notLogin","targetId":"6f4fd501-0bf7-f1a6-ed27-040382423d8c","targetPort":"navigate"},{"sourceId":"8a5c283f-12e5-2678-bab4-5436b2da6cbf","sourcePort":"didMount","targetId":"6c0b7163-2cd2-e01d-5ee7-de1f705ae1c8","targetPort":"run"},{"sourceId":"a05eeb97-237d-eaa7-e101-f3194f739ec5","sourcePort":"out-done","targetId":"6c0b7163-2cd2-e01d-5ee7-de1f705ae1c8","targetPort":"run"},{"sourceId":"04162095-8493-48e0-5249-1c4608d98b57","sourcePort":"onTextChanged","targetId":"f2b5b802-1c2c-1c82-378d-86c4b3b871a3","targetPort":"in-text"},{"sourceId":"8a5c283f-12e5-2678-bab4-5436b2da6cbf","sourcePort":"didMount","targetId":"9472e10d-1e99-c662-add7-335a64507b57","targetPort":"run"},{"sourceId":"e165f2bb-6b3f-bb05-8792-db0a60d9ce17","sourcePort":"out-list","targetId":"feb5e6ea-7c4a-0cb2-63dd-97f23b349e42","targetPort":"items"},{"sourceId":"feb5e6ea-7c4a-0cb2-63dd-97f23b349e42","sourcePort":"items","targetId":"ddb3b8ec-c7f3-1fe8-390e-bc83773a5977","targetPort":"items"},{"sourceId":"9472e10d-1e99-c662-add7-335a64507b57","sourcePort":"out-newMessage","targetId":"e165f2bb-6b3f-bb05-8792-db0a60d9ce17","targetPort":"run"},{"sourceId":"8a5c283f-12e5-2678-bab4-5436b2da6cbf","sourcePort":"didMount","targetId":"e165f2bb-6b3f-bb05-8792-db0a60d9ce17","targetPort":"run"},{"sourceId":"e165f2bb-6b3f-bb05-8792-db0a60d9ce17","sourcePort":"out-done","targetId":"04162095-8493-48e0-5249-1c4608d98b57","targetPort":"clear"},{"sourceId":"6c0b7163-2cd2-e01d-5ee7-de1f705ae1c8","sourcePort":"out-username","targetId":"f2b5b802-1c2c-1c82-378d-86c4b3b871a3","targetPort":"in-user_sent"},{"sourceId":"41e17117-7498-45c0-6ff1-9ada4a754e38","sourcePort":"pm-room_id","targetId":"ce28e14c-4f11-ea1b-7b59-ff3f8bfb40a5","targetPort":"text"},{"sourceId":"41e17117-7498-45c0-6ff1-9ada4a754e38","sourcePort":"pm-room_id","targetId":"f2b5b802-1c2c-1c82-378d-86c4b3b871a3","targetPort":"in-room_id"},{"sourceId":"8a5c283f-12e5-2678-bab4-5436b2da6cbf","sourcePort":"didMount","targetId":"0b2e6f00-4aec-2572-6f43-6b168d79de00","targetPort":"run"},{"sourceId":"0b2e6f00-4aec-2572-6f43-6b168d79de00","sourcePort":"out-noRoomId","targetId":"ab1fcfd9-cb1f-59ef-4d09-cb64724cadb8","targetPort":"navigate"},{"sourceId":"41e17117-7498-45c0-6ff1-9ada4a754e38","sourcePort":"pm-room_id","targetId":"0b2e6f00-4aec-2572-6f43-6b168d79de00","targetPort":"in-room_id"},{"sourceId":"41e17117-7498-45c0-6ff1-9ada4a754e38","sourcePort":"pm-room_id","targetId":"e165f2bb-6b3f-bb05-8792-db0a60d9ce17","targetPort":"in-room_id"},{"sourceId":"ce1564e1-1c2f-26cc-1db7-cb8590e37c84","sourcePort":"onClick","targetId":"a05eeb97-237d-eaa7-e101-f3194f739ec5","targetPort":"run"},{"sourceId":"6c0b7163-2cd2-e01d-5ee7-de1f705ae1c8","sourcePort":"out-username","targetId":"736cf198-f1f0-2f69-9a01-3029928207ca","targetPort":"text"},{"sourceId":"c696ce8c-a668-fd3f-fb66-935de896d247","sourcePort":"onClick","targetId":"15222e2c-334a-3329-40a6-6f5dad679f23","targetPort":"navigate"},{"sourceId":"a389691e-c35f-3593-0db4-03da8ca62a3e","sourcePort":"onClick","targetId":"1a7a442d-276f-1084-6aa6-4e530b14e297","targetPort":"run"},{"sourceId":"04162095-8493-48e0-5249-1c4608d98b57","sourcePort":"onEnter","targetId":"1a7a442d-276f-1084-6aa6-4e530b14e297","targetPort":"run"},{"sourceId":"1a7a442d-276f-1084-6aa6-4e530b14e297","sourcePort":"out-hasText","targetId":"f2b5b802-1c2c-1c82-378d-86c4b3b871a3","targetPort":"run"},{"sourceId":"04162095-8493-48e0-5249-1c4608d98b57","sourcePort":"onTextChanged","targetId":"1a7a442d-276f-1084-6aa6-4e530b14e297","targetPort":"in-text"}],"ports":[],"roots":["8a5c283f-12e5-2678-bab4-5436b2da6cbf"]},{"name":"/message","nodes":[{"id":"9b444e8d-8be3-7d44-bfb6-7dc4983aa4f8","type":"Group","parameters":{"sizeMode":"contentHeight","borderStyle":"solid","borderWidth":{"value":1,"unit":"px"},"flexDirection":"row"},"ports":[],"children":[{"id":"9141c23e-42a6-c374-2ada-0c73a29b9ead","type":"Group","parameters":{"sizeMode":"contentSize","marginRight":{"value":4,"unit":"px"}},"ports":[],"children":[{"id":"7c2cc3b0-32bf-dd3b-07ce-22f61628fb93","type":"Text","parameters":{"color":"#FF0000","fontFamily":"fonts/Roboto/Roboto-BoldItalic.ttf"},"ports":[],"children":[]},{"id":"29c9f651-a1f0-3adb-5284-360667cdc80f","type":"Text","parameters":{"fontSize":{"value":12,"unit":"px"},"color":"Grey - 600","fontFamily":"fonts/Roboto/Roboto-LightItalic.ttf"},"ports":[],"children":[]}]},{"id":"2115d69e-e957-28b9-6da5-356f6e12dff6","type":"Text","parameters":{"textAlignX":"left"},"ports":[],"children":[]}]},{"id":"48a483dc-35a2-4214-6491-68765a667c8e","type":"Model2","parameters":{"idSource":"foreach","properties":"text,user_sent,created"},"ports":[],"children":[]},{"id":"1a0f3f7a-2cb6-31ae-8858-30bbbc6affcc","type":"JavaScriptFunction","parameters":{"functionScript":"\r\n  const date = new Date(Inputs.date);\r\n\r\n  // Chuyển đổi sang giờ Việt Nam (GMT+7)\r\n  const options = { timeZone: 'Asia/Ho_Chi_Minh', year: 'numeric', month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit' };\r\n  const vietnamTimeString = date.toLocaleString('sv-SE', options).replace(' ', 'T');\r\n\r\n  // Tách ngày và giờ để định dạng lại\r\n  const [datePart, timePart] = vietnamTimeString.split('T');\r\n  const formattedDate = `${datePart} ${timePart}`;\r\n  Outputs.date = formattedDate;"},"ports":[{"name":"in-date","displayName":"date","plug":"input","type":"*","group":"Inputs","index":4},{"name":"out-date","displayName":"date","plug":"output","type":"*","group":"Outputs","index":5}],"children":[]}],"connections":[{"sourceId":"48a483dc-35a2-4214-6491-68765a667c8e","sourcePort":"prop-text","targetId":"2115d69e-e957-28b9-6da5-356f6e12dff6","targetPort":"text"},{"sourceId":"48a483dc-35a2-4214-6491-68765a667c8e","sourcePort":"prop-user_sent","targetId":"7c2cc3b0-32bf-dd3b-07ce-22f61628fb93","targetPort":"text"},{"sourceId":"48a483dc-35a2-4214-6491-68765a667c8e","sourcePort":"prop-created","targetId":"1a0f3f7a-2cb6-31ae-8858-30bbbc6affcc","targetPort":"in-date"},{"sourceId":"9b444e8d-8be3-7d44-bfb6-7dc4983aa4f8","sourcePort":"didMount","targetId":"1a0f3f7a-2cb6-31ae-8858-30bbbc6affcc","targetPort":"run"},{"sourceId":"1a0f3f7a-2cb6-31ae-8858-30bbbc6affcc","sourcePort":"out-date","targetId":"29c9f651-a1f0-3adb-5284-360667cdc80f","targetPort":"text"}],"ports":[],"roots":["9b444e8d-8be3-7d44-bfb6-7dc4983aa4f8"]}]